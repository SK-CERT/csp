<!--
 * CoreUI - Open Source Bootstrap Admin Template
 * @version v1.0.0-alpha.4
 * @link http://coreui.io
 * Copyright (c) 2017 creativeLabs Łukasz Holeczek
 * @license MIT
 -->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="layout">

<div layout:fragment="content">
	<div
		class="app header-fixed sidebar-fixed aside-menu-fixed aside-menu-hidden">

		<div class="col-md-8">
			<div class="card-group mb-0">
				<div class="card p-4">
					<div class="card-block">
						<h1>Scheduled meetings</h1>
						<div th:if="${meetings.empty}">Nothing to diplay yet</div>
						<div th:unless="${meetings.empty}">
							<form id="cancellation-form" action="#"
								th:action="@{/cancelMeeting}" method="post">
								<table class="table">
									<thead>
										<tr>
											<th><input type="checkbox" id="selectall" value=""></input></th>
											<th>Start Date and Time</th>
											<th>Duration</th>
											<th>Participants</th>
											<th>Status</th>
										</tr>
									</thead>
									<tbody>
										<tr class="currentmeeting"
											th:each="meeting, stat : ${meetings}">
											<th scope="row"><input class="todelete" type="checkbox"
												name="id" th:value="${meeting.id}"
												th:attr="data-date=${{meeting.start}},data-duration=${{meeting.duration}}"></input></th>
											<td th:text="${{meeting.start}}">start</td>
											<td th:text="${{meeting.duration}}">duration</td>
											<td th:text="${#lists.size(meeting.participants)}">#ofparticipants</td>
											<td th:text="${meeting.status}">status</td>
										</tr>
									</tbody>
								</table>
								<div class="row">
									<div class="col-6">

										<button id="cancel_meeting_button" type="button"
											class="btn btn-primary px-4">Cancel</button>
									</div>
								</div>
							</form>
						</div>

					</div>
				</div>

			</div>
			<div class="card-group mb-0">
				<div class="card p-4">
					<div class="card-block">
						<h1>Past meetings</h1>
						<div th:if="${pastMeetings.empty}">Nothing to diplay yet</div>
						<div th:unless="${pastMeetings.empty}">
							<table class="table">
								<thead>
									<tr>
										<th>Start Date and Time</th>
										<th>Duration</th>
										<th>Participants</th>
										<th>Status</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="meeting, stat : ${pastMeetings}">
										<td th:text="${{meeting.start}}">start</td>
										<td th:text="${meeting.durationAsTime}">duration</td>
										<td th:text="${#lists.size(meeting.participants)}">#ofparticipants</td>
										<td><span th:text="${meeting.status}"></span><sup
											th:if="${#strings.toString(meeting.status) == 'Error'}">
												<a href="#" th:href="@{/retryMeeting(id=${meeting.id})}">Retry</a>
										</sup></td>
									</tr>
								</tbody>
							</table>
						</div>

					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="confirm-cancel" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">Confirm Meeting Cancellation</div>
				<div class="modal-body">
					The following meetings are about to be cancelled. On confirmation,
					all participants will be notified via email and access will be
					revoked. Please confirm to continue.
					<table class="table">
						<thead>
							<tr>
								<th>Datetime</th>
								<th>Duration</th>
							</tr>
						</thead>
						<tbody id="meetingstobecancelled">
							<tr>
								<td>dddd</td>
								<td>ffff</td>
							</tr>
						</tbody>
					</table>

				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
					<a href="#" id="submit-cancellation"
						class="btn btn-success success">Submit</a>
				</div>
			</div>
		</div>
	</div>
</div>
<div layout:fragment="scripts">

	<script>
		$(document)
				.ready(
						function() {

							$("#selectall").change(
									function() {
										checked = this.checked;
										$("tr.currentmeeting").each(
												function() {
													$this = $(this);
													$(this).find(
															"input.todelete")
															.prop('checked',
																	checked);
												});
									});
							$("#cancel_meeting_button")
									.click(
											function(e) {
												e.preventDefault();
												$("#meetingstobecancelled tr")
														.remove();
												var i = 0;
												$("tr.currentmeeting")
														.each(
																function() {

																	$this = $(this);
																	$(this)
																			.find(
																					"input.todelete")
																			.each(
																					function() {
																						if ($(
																								this)
																								.prop(
																										'checked') == true) {
																							i++;
																							$(
																									"#meetingstobecancelled")
																									.append(
																											'<tr><td>'
																													+ $(
																															this)
																															.attr(
																																	"data-date")
																													+ '</td><td>'
																													+ $(
																															this)
																															.attr(
																																	"data-duration")
																													+ '</td></tr>');
																						}
																					});
																}

														);
												if (i > 0)
													$('#confirm-cancel').modal(
															'show');
											});
							$('#submit-cancellation').click(function() {
								$('#cancellation-form').submit();
							});
						});
	</script>
</div>
</html>